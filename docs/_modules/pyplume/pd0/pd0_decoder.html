<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyplume.pd0.pd0_decoder &mdash; pyplume  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../../../_static/logo.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pyplume
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pd0%20Dataset.html"><strong>Pd0 Dataset</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ctd%20Dataset.html"><strong>CTD Dataset</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Pose.html"><strong>Pose</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Data%20Manager.html"><strong>Data Manager</strong></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyplume</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyplume.pd0.pd0_decoder</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyplume.pd0.pd0_decoder</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Wed Jul 19 15:24:17 2023</span>

<span class="sd">@author: anba</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">struct</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">time</span><span class="o">,</span><span class="nn">datetime</span>


<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1">#sys.path.insert(1, r&#39;C:\Users\anba\Desktop\Projects\pyplume\pyplume\ptools&#39;)</span>
<span class="c1">#import ptools</span>


<span class="c1"># # # from plotting import plotting</span>
<span class="c1"># # # from processing import processing</span>
<span class="c1"># # # from geometry import geometry</span>
<span class="c1"># # # from masking import masking</span>
<span class="c1"># # # from PT3 import PT3</span>


<span class="kn">from</span> <span class="nn">..ptools</span> <span class="kn">import</span> <span class="n">ptools</span>
<span class="kn">from</span> <span class="nn">.plotting</span> <span class="kn">import</span> <span class="n">plotting</span>
<span class="kn">from</span> <span class="nn">.processing</span> <span class="kn">import</span> <span class="n">processing</span>
<span class="kn">from</span> <span class="nn">.geometry</span> <span class="kn">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">.masking</span> <span class="kn">import</span> <span class="n">masking</span>
<span class="kn">from</span> <span class="nn">.PT3</span> <span class="kn">import</span> <span class="n">PT3</span>



<span class="c1">#%% Data formats from </span>

<span class="c1"># WorkHorse Commands and Output Data Format</span>

<span class="n">ensemble_header_format</span> <span class="o">=</span> <span class="p">(</span>  
    <span class="p">(</span><span class="s1">&#39;HEADER ID&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;DATA SOURCE ID&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;N BYTES IN ENSEMBLE&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SPARE&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
<span class="p">)</span>


<span class="n">fixed_leader_format</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;FIXED LEADER ID&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;CPU F/W VER.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;CPU F/W REV.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;REAL/SIM FLAG&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;LAG LENGTH&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;NUMBER OF BEAMS&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;PINGS PER ENSEMBLE </span><span class="si">{WP}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;DEPTH CELL LENGTH </span><span class="si">{WS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BLANK AFTER TRANSMIT </span><span class="si">{WF}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;PROFILING MODE </span><span class="si">{WM}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;LOW CORR THRESH </span><span class="si">{WC}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;NO. CODE REPS&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;</span><span class="si">%G</span><span class="s1">D MINIMUM </span><span class="si">{WG}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ERROR VELOCITY MAXIMUM </span><span class="si">{WE}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;TPP MINUTES&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;TPP SECONDS&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;TPP HUNDREDTHS </span><span class="si">{TP}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;COORDINATE TRANSFORM </span><span class="si">{EX}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;HEADING ALIGNMENT </span><span class="si">{EA}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;HEADING BIAS </span><span class="si">{EB}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SENSOR SOURCE </span><span class="si">{EZ}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SENSORS AVAILABLE&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BIN 1 DISTANCE&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;XMIT PULSE LENGTH BASED ON </span><span class="si">{WT}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;starting cell WP REF LAYER AVERAGE </span><span class="si">{WL}</span><span class="s1"> ending cell&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;FALSE TARGET THRESH </span><span class="si">{WA}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SPARE1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;TRANSMIT LAG DISTANCE&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;CPU BOARD SERIAL NUMBER&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SYSTEM BANDWIDTH </span><span class="si">{WB}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SYSTEM POWER </span><span class="si">{CQ}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SPARE2&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;INSTRUMENT SERIAL NUMBER&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM ANGLE&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">variable_leader_format</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;VARIABLE LEADER ID&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC YEAR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC MONTH </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC DAY </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC HOUR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC MINUTE </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC SECOND </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC HUNDREDTHS </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ENSEMBLE # MSB&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BIT RESULT&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SPEED OF SOUND </span><span class="si">{EC}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;DEPTH OF TRANSDUCER </span><span class="si">{ED}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;HEADING </span><span class="si">{EH}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;PITCH TILT 1 </span><span class="si">{EP}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ROLL TILT 2 </span><span class="si">{ER}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SALINITY </span><span class="si">{ES}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;TEMPERATURE </span><span class="si">{ET}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;MPT MINUTES&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;MPT SECONDS&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;MPT HUNDREDTHS&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;HDG STD DEV&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;PITCH STD DEV&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ROLL STD DEV&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 0&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 2&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 3&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 4&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 5&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 6&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ADC CHANNEL 7&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;ERROR STATUS WORD ESW </span><span class="si">{CY}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SPARE1&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;PRESSURE&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;PRESSURE SENSOR VARIANCE&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;SPARE2&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC CENTURY&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC YEAR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC MONTH&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC DAY&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC HOUR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC MINUTE&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC SECOND&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RTC HUNDREDTH&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">bottom_track_format</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;BOTTOM-TRACK ID&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT PINGS PER ENSEMBLE </span><span class="si">{BP}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT DELAY BEFORE RE-ACQUIRE </span><span class="si">{BD}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT CORR MAG MIN </span><span class="si">{BC}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT EVAL AMP MIN </span><span class="si">{BA}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT PERCENT GOOD MIN </span><span class="si">{BG}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT MODE </span><span class="si">{BM}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT ERR VEL MAX </span><span class="si">{BE}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Reserved&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#1 BT RANGE&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#2 BT RANGE&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#3 BT RANGE&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#4 BT RANGE&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#1 BT VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#2 BT VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#3 BT VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#4 BT VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#1 BT CORR.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#2 BT CORR.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#3 BT CORR.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#4 BT CORR.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#1 EVAL AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#2 EVAL AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#3 EVAL AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#4 EVAL AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#1 BT </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#2 BT </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#3 BT </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#4 BT </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;REF LAYER MIN </span><span class="si">{BL}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;REF LAYER NEAR </span><span class="si">{BL}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;REF LAYER FAR </span><span class="si">{BL}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM#1 REF LAYER VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM #2 REF LAYER VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM #3 REF LAYER VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BEAM #4 REF LAYER VEL&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#1 REF CORR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#2 REF CORR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#3 REF CORR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#4 REF CORR&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#1 REF INT&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#2 REF INT&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#3 REF INT&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#4 REF INT&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#1 REF </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#2 REF </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#3 REF </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#4 REF </span><span class="si">%G</span><span class="s1">OOD&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BT MAX. DEPTH </span><span class="si">{BX}</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#1 RSSI AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#2 RSSI AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#3 RSSI AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;BM#4 RSSI AMP&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;GAIN&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;*SEE BYTE 17&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;*SEE BYTE 19&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;*SEE BYTE 21&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;*SEE BYTE 23&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;RESERVED&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
<span class="p">)</span>        

<span class="n">address_offsets_format</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_ID_code_format</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="n">echo_intensity_format</span><span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="n">velocity_format</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="n">coor_mag_format</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pct_good_format</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>


<span class="c1">#%%</span>
<div class="viewcode-block" id="Pd0">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.Pd0">[docs]</a>
<span class="k">class</span> <span class="nc">Pd0</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for parsing and managing data from pd0 files, which are commonly used in</span>
<span class="sd">    oceanographic data collection with ADCP (Acoustic Doppler Current Profiler) instruments.</span>

<span class="sd">    This class provides functionality to read, process, validate, and access ensemble data</span>
<span class="sd">    from pd0 files. It includes methods for navigating through the data, retrieving specific</span>
<span class="sd">    ensembles, and extracting metadata and hydrodynamic measurements such as velocity and echo intensity.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _filepath (str): Path to the pd0 file being processed.</span>
<span class="sd">        _checksum (NoneType or bytearray): Checksum used for verifying the integrity of read data.</span>
<span class="sd">        _ensemble_rollover (int): Counter to manage the rollover of ensemble indices due to limitations in counting.</span>
<span class="sd">        _address_offsets (list of int): List of byte offsets for accessing specific data blocks within the file.</span>
<span class="sd">        ensemble_data (list of dicts): Parsed ensemble data stored as dictionaries.</span>
<span class="sd">        metadata (metadata): An instance of the nested metadata class containing detailed information about the file.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __init__(filepath, **kwargs): Constructor for initializing a Pd0 instance.</span>
<span class="sd">        __get_first_and_last_ensembles(): Retrieves the first and last ensembles to determine the scope of the data.</span>
<span class="sd">        __skip_to_ensemble(n): Skips to a specified ensemble number within the file.</span>
<span class="sd">        __find_previous_ensemble(dist, maxiter, offset): Searches backwards to find the start of a valid ensemble.</span>
<span class="sd">        __find_next_ensemble(dist, maxiter, offset): Searches forwards to find the start of a valid ensemble.</span>
<span class="sd">        __check_valid_ensemble(ensemble): Checks the validity of an ensemble based on predefined criteria.</span>
<span class="sd">        __read_ensembles(start, end, print_progress): Reads a range of ensembles from the file.</span>
<span class="sd">        __read_ensemble(): Reads and parses a single ensemble from the file.</span>
<span class="sd">        __read_ensemble_header(): Reads and parses the header of an ensemble.</span>
<span class="sd">        __read_fixed_leader(): Reads and parses the fixed leader of an ensemble.</span>
<span class="sd">        __read_variable_leader(): Reads and parses the variable leader of an ensemble.</span>
<span class="sd">        __read_next_bytes(fmt): Reads bytes from the file according to a specified format.</span>
<span class="sd">        __get_LE_bit_string(byte): Converts a byte into a string of bits (little-endian).</span>
<span class="sd">        __parse_system_configuration(syscfg): Parses system configuration data.</span>
<span class="sd">        __parse_EX_command(ex): Parses coordinate transformation commands.</span>
<span class="sd">        write_pd0(fname): Writes parsed data back to a new pd0 file.</span>
<span class="sd">        __write_ensemble(ensemble): Writes a single ensemble&#39;s data to a file.</span>
<span class="sd">        __write_next_bytes(x, fmt): Writes data to a file in a specified byte format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
<div class="viewcode-block" id="Pd0.__init__">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.Pd0.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filepath</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span> <span class="o">=</span> <span class="n">filepath</span> <span class="c1"># filepath for general use across methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># checksum for general use across methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensemble_rollover</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># counter for ensemble rollover (at 65,536)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address_offsets</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># for general use across methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span> <span class="o">=</span> <span class="p">[]</span>
        
 
        <span class="k">class</span> <span class="nc">metadata</span><span class="p">:</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pd0</span><span class="p">):</span>
                <span class="c1">#ef,el = pd0.__get_first_and_last_ensembles()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">filepath</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filesize</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">first_ensemble_in_file</span><span class="o">=</span> <span class="n">ef</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_ensemble_in_file</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">]</span>
                
                
                <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_size</span> <span class="o">=</span> <span class="n">ef</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;N BYTES IN ENSEMBLE&#39;</span><span class="p">]</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">first_date_in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_ensemble_datetime</span><span class="p">(</span><span class="n">ef</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">last_date_in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__format_ensemble_datetime</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                
                <span class="c1"># ## calculate number of ensembles in the file</span>
                <span class="c1"># # case where the ensemble count rolled over in the file</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_ensemble_in_file</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_ensemble_in_file</span><span class="p">:</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles_in_file</span> <span class="o">=</span> <span class="p">(</span><span class="mi">65536</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_ensemble_in_file</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_ensemble_in_file</span>
                <span class="k">else</span><span class="p">:</span>   
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles_in_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_ensemble_in_file</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_ensemble_in_file</span> <span class="o">+</span> <span class="mi">1</span>   
                
            <span class="k">def</span> <span class="nf">__format_ensemble_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ensemble</span><span class="p">):</span>
                
                    <span class="n">century</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC CENTURY&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">century</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="n">century</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span> <span class="c1">#Catch for UNKNOWN bug that occures when parsing DVS instruments</span>
                    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">century</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC YEAR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]))</span>
                    <span class="n">month</span><span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC MONTH </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
                    <span class="n">day</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC DAY </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC HOUR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
                    <span class="n">minute</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC MINUTE </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
                    <span class="n">second</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC SECOND </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
                    <span class="n">hundredth</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC HUNDREDTHS </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">dtime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span><span class="n">minute</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">hundredth</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> 
                    <span class="k">except</span><span class="p">:</span> 
                        <span class="n">dtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">return</span> <span class="n">dtime</span>
                        
                        
                        
        <span class="n">ef</span><span class="p">,</span><span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_first_and_last_ensembles</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
   
    
        <span class="n">import_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;import_file&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">print_progress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;print_progress&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#######################################################################</span>
        
        <span class="k">if</span> <span class="n">import_file</span><span class="p">:</span>

            <span class="c1">## Read the file </span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">n_ensembles_in_file</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensembles</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span> <span class="n">print_progress</span> <span class="o">=</span> <span class="n">print_progress</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span>
            
            <span class="k">if</span> <span class="n">print_progress</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">loaded </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_ensembles</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">n_ensembles_in_file</span><span class="si">}</span><span class="s1"> ensembles from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

            

                
        

    <span class="k">def</span> <span class="nf">__get_first_and_last_ensembles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#retrieve first and last ensembles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__find_next_ensemble</span><span class="p">())</span>

        <span class="n">first_ensemble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensemble</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">SEEK_END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__find_previous_ensemble</span><span class="p">())</span>
        <span class="n">last_ensemble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensemble</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span>


        <span class="k">return</span> <span class="n">first_ensemble</span><span class="p">,</span><span class="n">last_ensemble</span>  
    
    
    <span class="k">def</span> <span class="nf">__skip_to_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        
        
        
        <span class="c1"># identify the ensemble in the file with number n</span>
        <span class="k">def</span> <span class="nf">get_relative_ensemble_number</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            determine the ensemble number relative to the first ensemble in the </span>
<span class="sd">            file. 1 = first ensemble in file. </span>
<span class="sd">            assumes that the file is at the ensemble header byte position. </span>

<span class="sd">            &#39;&#39;&#39;</span>
 
            <span class="n">init_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="n">ens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensemble</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_address_offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="c1"># move to variable leader start byte </span>
            <span class="n">en</span> <span class="o">=</span> <span class="n">ens</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">first_ensemble_in_file</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">init_pos</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">en</span>


        <span class="n">init_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">init_guess</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">ensemble_size</span><span class="o">*</span><span class="nb">max</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        
    
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">init_guess</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__find_next_ensemble</span><span class="p">())</span>
        
        
        <span class="c1">## adjust for first ensemble in the file </span>
        
        <span class="n">en</span> <span class="o">=</span> <span class="n">get_relative_ensemble_number</span><span class="p">()</span> 
        <span class="n">diff</span> <span class="o">=</span> <span class="n">en</span> <span class="o">-</span> <span class="n">n</span>

        <span class="c1">#search = False</span>
        
        <span class="n">maxiter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">n_ensembles_in_file</span>
        <span class="n">_iter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># successful search</span>
        <span class="k">while</span> <span class="n">diff</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">_iter</span><span class="o">+=</span><span class="mi">1</span>
            <span class="c1">#search = True</span>
            <span class="k">if</span> <span class="n">diff</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> 
                <span class="c1">#print(diff)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__find_previous_ensemble</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
                <span class="c1">#print(f&#39;\rb {diff} en = {en}  n = {n}&#39;, end = &#39;\r&#39;)</span>
                <span class="c1">#time.sleep(.1)</span>
            <span class="k">elif</span> <span class="n">diff</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> 
                <span class="c1">#print(f&#39;\rf {diff} en = {en} n = {n}&#39;, end = &#39;\n&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__find_next_ensemble</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
                <span class="c1">#time.sleep(.1)</span>
                
                
            <span class="n">en</span> <span class="o">=</span> <span class="n">get_relative_ensemble_number</span><span class="p">()</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">en</span> <span class="o">-</span> <span class="n">n</span>
            
            
            
            
            <span class="k">if</span> <span class="n">_iter</span> <span class="o">&gt;</span> <span class="n">maxiter</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># search failed</span>
                <span class="k">break</span>
          
         
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__find_previous_ensemble</span><span class="p">())</span> <span class="c1"># adjust for last ensemble read</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># if search failed, return to initial file position </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">init_pos</span><span class="p">)</span>
            <span class="c1"># if search failed, return to start point </span>
            
        <span class="c1"># elif diff&gt;0: self._file.seek(self.__find_next_ensemble(offset = True))</span>
        <span class="c1"># else: self._file.seek(self.__find_previous_ensemble())</span>
            
        
        <span class="k">return</span> <span class="n">success</span>
        
        
        
        


    <span class="k">def</span> <span class="nf">__find_previous_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">maxiter</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        find the position of the first byte of the previous valid ensemble in the </span>
<span class="sd">        file. If no valid ensembles are found, then the position of the beginning of </span>
<span class="sd">        the search file will be returned. </span>
<span class="sd">        </span>
<span class="sd">        The file is always returned to its starting position at the time of the </span>
<span class="sd">        function call. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dist : int, optional</span>
<span class="sd">            number of bytes to read in each iteration. This value must be larger </span>
<span class="sd">            than the size of an ensemble to The default is 2000.</span>
<span class="sd">        maxiter : int, optional</span>
<span class="sd">            numer of iterations to perform. The default is 100.</span>
<span class="sd">        offset : bool, optinal</span>
<span class="sd">            whether to ignore the first two bytes (case where its on the next ensemble already)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pos : int</span>
<span class="sd">            position of the starting byte for the next valid enseble in the file. </span>
<span class="sd">            If no valid ensembles are found, then the position of the end of the file will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">init_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="c1"># file position at the beginning of the search </span>
        <span class="c1"># start_pos = max(init_pos - dist,0) # starting position in file for the current iteration</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">offset</span><span class="p">:</span><span class="n">start_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">init_pos</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># starting position in file for the current iteration</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">start_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">init_pos</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># starting position in file for the current iteration</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># indicator variable for successful search </span>
        <span class="n">_iter</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of iterations </span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span> <span class="c1"># while a valid ensemble has not been found,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start_pos</span><span class="p">)</span> <span class="c1"># seek to the start position for the iteration</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x7f\x7f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)]</span> <span class="c1"># read bytes and search for an instance of the ensemble header ID b&#39;\x7f\x7f&#39;</span>
            <span class="c1">#print(headers)</span>
            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span> <span class="c1"># loop over identtified headers </span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">start_pos</span> <span class="o">+</span> <span class="n">header</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c1"># byte position for the beginning of the header </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="c1"># seek to byte position for the beginning of the header </span>
                <span class="k">try</span><span class="p">:</span> 
                    <span class="n">ensemble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensemble</span><span class="p">()</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__check_valid_ensemble</span><span class="p">(</span><span class="n">ensemble</span><span class="p">)</span>
                    <span class="c1">#print(&#39;p&#39;,ensemble[&#39;VARIABLE LEADER&#39;][&#39;ENSEMBLE NUMBER&#39;])</span>
                <span class="k">except</span><span class="p">:</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">valid</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># break the loop if the ensemble is valid</span>

            <span class="c1"># step backwards</span>
            <span class="n">start_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_pos</span> <span class="o">-</span> <span class="n">dist</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start_pos</span><span class="p">)</span>
            
            <span class="c1"># update iteration count</span>
            <span class="n">_iter</span><span class="o">+=</span><span class="mi">1</span> 
            
            <span class="c1">## other termination conditions</span>
            <span class="n">term_conds</span> <span class="o">=</span> <span class="p">[</span><span class="n">_iter</span><span class="o">&gt;=</span><span class="n">maxiter</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span><span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            
            
            
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">term_conds</span><span class="p">):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1">#print(&#39;maxout&#39;)</span>
                <span class="k">break</span>
        
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">init_pos</span><span class="p">)</span> <span class="c1"># return file to initial position </span>
        <span class="k">return</span> <span class="n">pos</span> 


    <span class="k">def</span> <span class="nf">__find_next_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dist</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">maxiter</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span><span class="n">offset</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        find the position of the first byte of the next valid ensemble in the </span>
<span class="sd">        file. If no valid ensembles are found, then the position of the end of </span>
<span class="sd">        the search file will be returned. </span>
<span class="sd">        </span>
<span class="sd">        The file is always returned to its starting position at the time of the </span>
<span class="sd">        function call. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dist : int, optional</span>
<span class="sd">            number of bytes to read in each iteration. This value must be larger </span>
<span class="sd">            than the size of an ensemble to The default is 3000.</span>
<span class="sd">        maxiter : int, optional</span>
<span class="sd">            numer of iterations to perform. The default is 100.</span>
<span class="sd">        offset : bool, optinal</span>
<span class="sd">            whether to ignore the first two bytes (case where its on the next ensemble already)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pos : int</span>
<span class="sd">            position of the starting byte for the next valid enseble in the file. </span>
<span class="sd">            If no valid ensembles are found, then the position of the end of the file will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># global ensemble2</span>
        <span class="c1"># ensemble2 = self.__read_ensemble()</span>
        <span class="n">init_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="c1"># file position at the beginning of the search </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">offset</span><span class="p">:</span><span class="n">start_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">init_pos</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># starting position in file for the current iteration</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">start_pos</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">init_pos</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># starting position in file for the current iteration</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># indicator variable for successful search </span>
        <span class="n">_iter</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of iterations </span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span> <span class="c1"># while a valid ensemble has not been found,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start_pos</span><span class="p">)</span> <span class="c1"># seek to the start position for the iteration</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x7f\x7f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">dist</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)]</span> <span class="c1"># read bytes and search for an instance of the ensemble header ID b&#39;\x7f\x7f&#39;</span>
            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span> <span class="c1"># loop over identtified headers </span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">start_pos</span> <span class="o">+</span> <span class="n">header</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c1"># byte position for the beginning of the header </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="c1"># seek to byte position for the beginning of the header</span>
                
                <span class="c1"># ensemble = self.__read_ensemble()</span>
                <span class="c1"># valid = self.__check_valid_ensemble(ensemble)</span>
                <span class="c1">#ensemble = self.__read_ensemble()</span>
                <span class="k">try</span><span class="p">:</span> 
 
                    <span class="n">ensemble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensemble</span><span class="p">()</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__check_valid_ensemble</span><span class="p">(</span><span class="n">ensemble</span><span class="p">)</span>
                    <span class="c1">#print(f&#39;pos {pos}&#39;,ensemble[&#39;VARIABLE LEADER&#39;][&#39;ENSEMBLE NUMBER&#39;])</span>
                    
                <span class="k">except</span><span class="p">:</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">valid</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># break the loop if the ensemble is valid</span>

            <span class="c1"># step backwards</span>
            <span class="n">start_pos</span> <span class="o">=</span> <span class="n">start_pos</span> <span class="o">+</span> <span class="n">dist</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">start_pos</span><span class="p">)</span>
            <span class="n">_iter</span><span class="o">+=</span><span class="mi">1</span> <span class="c1"># update iteration count </span>
            <span class="c1">#print(start_pos)</span>
            <span class="c1">## other termination conditions</span>
            <span class="n">term_conds</span> <span class="o">=</span> <span class="p">[</span><span class="n">_iter</span><span class="o">&gt;</span><span class="n">maxiter</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span><span class="o">&gt;=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span><span class="p">)]</span>
        
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">term_conds</span><span class="p">):</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span><span class="p">)</span>
                <span class="c1">#print(term_conds)</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">init_pos</span><span class="p">)</span> <span class="c1"># return file to initial position </span>
        
        
       
        <span class="k">return</span> <span class="n">pos</span> 

    

    <span class="k">def</span> <span class="nf">__check_valid_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ensemble</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that an ensemble is valid </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ensemble : dict</span>
<span class="sd">            ensemble dictionary returned by __read_ensemble()</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        valid : bool</span>
<span class="sd">            True if all checks are passed</span>
<span class="sd">        &quot;&quot;&quot;</span>

        
        
        
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="c1">## check ensemble header fields </span>
        <span class="k">if</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>     
        <span class="k">if</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;HEADER ID&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">127</span><span class="p">:</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>     
        <span class="k">if</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;DATA SOURCE ID&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">127</span><span class="p">:</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span> 
        
        <span class="c1"># check a random data field </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;CORRELATION MAGNITUDE&#39;</span><span class="p">]):</span> <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>




        <span class="c1"># try to parse the date</span>
        <span class="n">century</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC CENTURY&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">century</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;19&#39;</span><span class="p">,</span><span class="s1">&#39;20&#39;</span><span class="p">]:</span> <span class="n">century</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span> 
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">century</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC YEAR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]))</span>
        <span class="n">month</span><span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC MONTH </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC DAY </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC HOUR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="n">minute</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC MINUTE </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="n">second</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC SECOND </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="n">hundredth</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC HUNDREDTHS </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span><span class="n">minute</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">hundredth</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>
        
        

            
        
        <span class="k">return</span> <span class="n">valid</span>
    
    
    
    <span class="k">def</span> <span class="nf">__read_ensembles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">end</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">print_progress</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read ensembles from the pd0 file. all ensembles between start and end</span>
<span class="sd">        will be read. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : int, optional</span>
<span class="sd">            first ensemble to read. If not specified, the first ensemble in the </span>
<span class="sd">            file will be used. </span>
<span class="sd">        end : int, optional</span>
<span class="sd">            last ensemble to read. If not specified, the last ensemble in the </span>
<span class="sd">            file will be used. </span>
<span class="sd">        print_progress : bool, optional</span>
<span class="sd">            If true a progress bar will be printed. The default is true.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        

        <span class="c1">## set default parameters</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span> 
        <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">n_ensembles_in_file</span> 
        
        <span class="c1">#print(start,end)</span>
        <span class="c1">## check that start/end inputs are valid </span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Invalid start/end ensemble&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">n_ensembles_in_file</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">end</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">n_ensembles_in_file</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span><span class="o">&gt;</span><span class="n">end</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;start ensemble is greater than end ensemble&#39;</span><span class="p">)</span>




    
        


        <span class="c1"># # initalize the progress bar</span>
        <span class="c1"># if print_progress: ptools.printProgressBar(0, end-start,taskname = f&#39;{self.metadata.filepath.split(os.sep)[-1]}&#39;, prefix = &#39;parsing .pd0&#39;)</span>
        
        
        <span class="n">en</span> <span class="o">=</span> <span class="n">start</span> <span class="c1"># most recent ensemble number read </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_ensembles</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># number of ensembles read so far</span>
        
        <span class="c1">## open the file for reading </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filepath</span><span class="p">,</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__skip_to_ensemble</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="c1"># skip to the start ensemble</span>
        
        
        <span class="c1">## read the next ensemble until the end ensemble has been reached</span>
        <span class="k">while</span> <span class="n">en</span><span class="o">&lt;=</span><span class="n">end</span><span class="p">:</span>    
            <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># indicator for whther the read was successful</span>
            <span class="c1">#print(en)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ensemble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensemble</span><span class="p">()</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__check_valid_ensemble</span><span class="p">(</span><span class="n">ensemble</span><span class="p">)</span> <span class="c1"># check if it is a valid ensemble </span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="kc">None</span>
 


            <span class="k">if</span> <span class="n">valid</span><span class="p">:</span><span class="c1"># if its a valid ensemble update some other stuff</span>
                <span class="c1"># account for ensemble rollover</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ensemble</span><span class="p">)</span> <span class="c1"># append to global ensemble data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_ensembles</span> <span class="o">+=</span><span class="mi">1</span> <span class="c1"># update ensemble number counter </span>
                <span class="k">if</span> <span class="n">print_progress</span><span class="p">:</span> <span class="n">ptools</span><span class="o">.</span><span class="n">printProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_ensembles</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span><span class="n">taskname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;parsing .pd0&#39;</span><span class="p">)</span><span class="c1">## print progress</span>
                <span class="n">en</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">#ensemble[&#39;VARIABLE LEADER&#39;][&#39;ENSEMBLE NUMBER&#39;] # update the ensemble number </span>
                <span class="c1">#print(en)</span>
                
            <span class="k">else</span><span class="p">:</span> <span class="c1"># if ensemble is not valid, skip to the next valid ensemble </span>
            
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">filesize</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">ensemble_size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">## check if we&#39;re close to the end of the file </span>
                    <span class="n">curr_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                    <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__skip_to_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_ensembles</span><span class="o">+</span><span class="n">start</span><span class="p">)</span> <span class="c1"># skip to last known ensemble </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__find_next_ensemble</span><span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span> <span class="c1"># move forward one ensemble</span>
                
                
                <span class="c1"># print(self._n_ensembles+start+1)</span>
                <span class="c1">#success = self.__skip_to_ensemble(self._n_ensembles+start+1)</span>
                
                
                <span class="c1"># if not success:</span>
                <span class="c1">#     print(&#39;skipping&#39;)</span>
                <span class="c1">#     self._file.seek(self.__find_next_ensemble(offset = True))</span>

                

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">first_ensemble_read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">last_ensemble_read</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">]</span> 
        
        
        
    <span class="k">def</span> <span class="nf">__read_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">## check if the file is open</span>
        <span class="n">ensemble_start_byte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#add new entry to the file checksum</span>
        
        <span class="n">ensemble</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">:{},</span>
                      <span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">:</span> <span class="p">{},</span>
                      <span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">:</span> <span class="p">{},</span>
                      <span class="s1">&#39;VELOCITY&#39;</span><span class="p">:</span> <span class="p">[],</span>
                      <span class="s1">&#39;CORRELATION MAGNITUDE&#39;</span><span class="p">:[],</span>
                      <span class="s1">&#39;ECHO INTENSITY&#39;</span><span class="p">:[],</span>
                      <span class="s1">&#39;PERCENT GOOD&#39;</span><span class="p">:[],</span>
                      <span class="s1">&#39;BOTTOM TRACK&#39;</span><span class="p">:[],</span>
                      <span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">:{},</span>
                      <span class="s1">&#39;COORDINATE SYSTEM&#39;</span><span class="p">:</span> <span class="p">{}}</span> 

        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_ensemble_header</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">ensemble_start_byte</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_address_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_fixed_leader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">ensemble_start_byte</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_address_offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_variable_leader</span><span class="p">()</span>
        
        

        
    
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">ensemble_start_byte</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_address_offsets</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;VELOCITY ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">data_ID_code_format</span><span class="p">)</span><span class="c1">#_NextLittleEndianUnsignedShort(file,2,decode = True)</span>
        <span class="n">velocity_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span><span class="c1">#ensemble[&#39;FIXED LEADER&#39;][&#39;NUMBER OF BEAMS&#39;]):</span>
                <span class="n">cell_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">velocity_format</span><span class="p">))</span>
            <span class="n">velocity_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_data</span><span class="p">)</span> 

        <span class="c1">## Parse data type 4 (correlation Magnitude)</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ID CODE 4&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">data_ID_code_format</span><span class="p">)</span><span class="c1"># _NextLittleEndianUnsignedShort(file,2, decode = True)</span>
        <span class="n">corr_mag_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span><span class="c1">#ensemble[&#39;FIXED LEADER&#39;][&#39;NUMBER OF BEAMS&#39;]):</span>
                <span class="n">cell_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">coor_mag_format</span><span class="p">))</span> <span class="c1">#_NextLittleEndianUnsignedShort(file,1,decode = field[3]))</span>
            <span class="n">corr_mag_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_data</span><span class="p">)</span>

            
        <span class="c1">## Parse data type 5 (echo intensity)</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ID CODE 5&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">data_ID_code_format</span><span class="p">)</span><span class="c1"># _NextLittleEndianUnsignedShort(file,2,decode = True)</span>
        <span class="n">echo_intensity_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span><span class="c1">#ensemble[&#39;FIXED LEADER&#39;][&#39;NUMBER OF BEAMS&#39;]):</span>
                <span class="n">cell_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">echo_intensity_format</span><span class="p">))</span><span class="c1">#_NextLittleEndianUnsignedShort(file,1,decode = field[3]))</span>
            <span class="n">echo_intensity_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_data</span><span class="p">)</span>    
         
        <span class="c1">## Parse data type 6 (percent good)</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ID CODE 6&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">data_ID_code_format</span><span class="p">)</span><span class="c1">#_NextLittleEndianUnsignedShort(file,2, decode = True)</span>
        <span class="n">pct_good_data</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span><span class="c1">#ensemble[&#39;FIXED LEADER&#39;][&#39;NUMBER OF BEAMS&#39;]):</span>
                <span class="n">cell_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">pct_good_format</span><span class="p">))</span><span class="c1">#_NextLittleEndianUnsignedShort(file,1,decode = field[3]))</span>
            <span class="n">pct_good_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_data</span><span class="p">)</span>      
           
        <span class="c1"># read bottom track data, if recorded</span>
        <span class="k">if</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">]</span> <span class="o">==</span><span class="mi">7</span><span class="p">:</span>
            <span class="n">bottom_track</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">bottom_track_format</span><span class="p">:</span>  
                <span class="n">bottom_track</span><span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="c1"># _NextLittleEndianUnsignedShort(file,field[1],decode = field[3]) </span>
        <span class="k">else</span><span class="p">:</span> <span class="n">bottom_track</span> <span class="o">=</span> <span class="kc">None</span>          
        

        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VELOCITY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_data</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;CORRELATION MAGNITUDE&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">corr_mag_data</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ECHO INTENSITY&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">echo_intensity_data</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;PERCENT GOOD&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pct_good_data</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;BOTTOM TRACK&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">bottom_track</span>
   
        
        
        <span class="c1">#read reserved bit data </span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RESERVED BIT DATA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">data_ID_code_format</span><span class="p">)</span><span class="c1">#_NextLittleEndianUnsignedShort(file,2,decode = True)</span>
       
        <span class="c1"># read end of ensemble checksum </span>
        <span class="n">file_checksum</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;H&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#chacksum to verify</span>

        
        
        <span class="n">passed_checksum</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span><span class="p">)))</span><span class="o">%</span><span class="mi">65536</span> <span class="o">-</span> <span class="n">file_checksum</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#print(f&#39;checksum failed reading ensemble {ensemble[&quot;VARIABLE LEADER&quot;][&quot;ENSEMBLE NUMBER&quot;]} \n {diff} byte discrepancy&#39;)</span>
            <span class="n">passed_checksum</span> <span class="o">=</span> <span class="kc">False</span>
            
           
           
        <span class="c1">## get system configuration parameters </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">system_configuration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parse_system_configuration</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">])</span>  
        <span class="k">except</span><span class="p">:</span> 
            <span class="n">system_configuration</span> <span class="o">=</span> <span class="kc">None</span>
           
        <span class="n">coord_sys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__parse_EX_command</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;COORDINATE TRANSFORM </span><span class="si">{EX}</span><span class="s1">&#39;</span><span class="p">])</span>
        

        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">system_configuration</span>
        <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;COORDINATE SYSTEM&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">coord_sys</span>
        
        <span class="k">return</span> <span class="n">ensemble</span>
        
    <span class="k">def</span> <span class="nf">__read_ensemble_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#assumes file is already in starting position </span>
        <span class="n">ensemble_header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#self.__skip_to_next_header()</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">ensemble_header_format</span><span class="p">:</span>
            <span class="n">ensemble_header</span><span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
           
        <span class="n">ensemble_header</span><span class="p">[</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ensemble_header</span><span class="p">[</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">],</span><span class="mi">6</span><span class="p">)</span>    
            
        <span class="n">ensemble_header</span><span class="p">[</span><span class="s1">&#39;ADDRESS OFFSETS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble_header</span><span class="p">[</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">]):</span>
            <span class="n">ensemble_header</span><span class="p">[</span><span class="s1">&#39;ADDRESS OFFSETS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">address_offsets_format</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address_offsets</span> <span class="o">=</span> <span class="n">ensemble_header</span><span class="p">[</span><span class="s1">&#39;ADDRESS OFFSETS&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">ensemble_header</span>
    
    <span class="k">def</span> <span class="nf">__read_fixed_leader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#assumes file is already in starting position </span>
        <span class="n">fixed_leader</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fixed_leader_format</span><span class="p">:</span>
            <span class="n">fixed_leader</span><span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fixed_leader</span>
    
    <span class="k">def</span> <span class="nf">__read_variable_leader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
        <span class="c1">#assumes file is already in starting position</span>
        <span class="n">variable_leader</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">variable_leader_format</span><span class="p">:</span>
                <span class="n">variable_leader</span><span class="p">[</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__read_next_bytes</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                
                
        <span class="c1"># ## adjust for ensemble rollover </span>
        <span class="n">rollover</span> <span class="o">=</span> <span class="n">variable_leader</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE # MSB&#39;</span><span class="p">]</span>
        <span class="n">variable_leader</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">rollover</span><span class="o">*</span><span class="mi">65535</span>


        <span class="k">return</span> <span class="n">variable_leader</span> 
            

                     
    <span class="k">def</span> <span class="nf">__read_next_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fmt</span><span class="p">):</span>
        <span class="n">decode</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">raw_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># n_bytes_read += n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_bytes</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;B&#39;</span><span class="p">:</span>
                <span class="n">fmtstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fmt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}{</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}{</span><span class="n">fmt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> 
                
            <span class="k">elif</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">]:</span>
                <span class="n">fmtstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fmt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}{</span><span class="n">fmt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> 
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmtstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fmt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}{</span><span class="nb">int</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="si">}{</span><span class="n">fmt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                
            <span class="n">out</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmtstr</span><span class="p">,</span><span class="n">raw_bytes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">raw_bytes</span>
            
        <span class="k">if</span> <span class="n">decode</span><span class="p">:</span>    
            <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">raw_bytes</span>
        
        
    <span class="k">def</span> <span class="nf">__get_LE_bit_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">byte</span><span class="p">):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make a bit string from little endian byte</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            byte: a byte</span>
<span class="sd">        Returns:</span>
<span class="sd">            a string of ones and zeros, the bits in the byte</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># surely there&#39;s a better way to do this!!</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]:</span>  <span class="c1"># Little Endian</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">byte</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bits</span> <span class="o">+=</span> <span class="s2">&quot;1&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bits</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span>
        <span class="k">return</span> <span class="n">bits</span>     
    
          
    <span class="k">def</span> <span class="nf">__parse_system_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">syscfg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        determine the system configuration parameters from 2-byte hex</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            syscfg: 2-byte hex string </span>
<span class="sd">        Returns:</span>
<span class="sd">            dictionary of system configuration parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>    
    
        <span class="n">LSB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_LE_bit_string</span><span class="p">(</span><span class="n">syscfg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">MSB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_LE_bit_string</span><span class="p">(</span><span class="n">syscfg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1">## determine system configuration</span>
        <span class="c1">#key for Beam facing</span>
        <span class="n">beam_facing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;DOWN&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="s1">&#39;UP&#39;</span><span class="p">}</span>
        
        <span class="c1">#key for XDCR attached</span>
        <span class="n">xdcr_att</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;NOT ATTACHED&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="s1">&#39;ATTACHED&#39;</span><span class="p">}</span>
        
        <span class="c1"># key for sensor configuration</span>
        <span class="n">sensor_cfg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;00&#39;</span><span class="p">:</span><span class="s1">&#39;#1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;01&#39;</span><span class="p">:</span><span class="s1">&#39;#2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;10&#39;</span><span class="p">:</span><span class="s1">&#39;#3&#39;</span><span class="p">}</span>
        
        <span class="c1"># key for beam pattern</span>
        <span class="n">beam_pat</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;CONCAVE&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="s1">&#39;CONVEX&#39;</span><span class="p">}</span>
        
        <span class="c1"># key for system frequencies</span>
        <span class="n">sys_freq</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;000&#39;</span><span class="p">:</span><span class="s1">&#39;75-kHz&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;001&#39;</span><span class="p">:</span><span class="s1">&#39;150-kHz&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;010&#39;</span><span class="p">:</span><span class="s1">&#39;300-kHz&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;011&#39;</span><span class="p">:</span><span class="s1">&#39;600-kHz&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;100&#39;</span><span class="p">:</span><span class="s1">&#39;1200-kHz&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;101&#39;</span><span class="p">:</span><span class="s1">&#39;2400-kHz&#39;</span><span class="p">,}</span> 
        
        <span class="c1">## determine system configuration from MSB</span>
        <span class="n">janus</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;0100&#39;</span><span class="p">:</span><span class="s1">&#39;4-BM&#39;</span><span class="p">,</span>
                <span class="s1">&#39;0101&#39;</span><span class="p">:</span> <span class="s1">&#39;5-BM (DEMOD)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;1111&#39;</span><span class="p">:</span> <span class="s1">&#39;5-BM (2 DEMD)&#39;</span><span class="p">}</span>
        
        <span class="n">beam_angle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;00&#39;</span><span class="p">:</span> <span class="s1">&#39;15E&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;01&#39;</span><span class="p">:</span> <span class="s1">&#39;20E&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="s1">&#39;30E&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;11&#39;</span><span class="p">:</span> <span class="s1">&#39;OTHER&#39;</span><span class="p">}</span>
        
        <span class="n">system_configuration</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;BEAM FACING&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">beam_facing</span><span class="p">[</span><span class="n">LSB</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;XDCR HD&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">xdcr_att</span><span class="p">[</span><span class="n">LSB</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;SENSOR CONFIG&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">sensor_cfg</span><span class="p">[</span><span class="n">LSB</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]]</span>
        <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;BEAM PATTERN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beam_pat</span><span class="p">[</span><span class="n">LSB</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
        <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">sys_freq</span><span class="p">[</span><span class="n">LSB</span><span class="p">[</span><span class="mi">5</span><span class="p">:]]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;JANUS CONFIG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">janus</span><span class="p">[</span><span class="n">MSB</span><span class="p">[:</span><span class="mi">4</span><span class="p">]]</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;JANUS CONFIG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;UNKNOWN&#39;</span>
        
        <span class="n">system_configuration</span><span class="p">[</span><span class="s1">&#39;BEAM ANGLE&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">beam_angle</span><span class="p">[</span><span class="n">MSB</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]]</span>
    
        <span class="k">return</span> <span class="n">system_configuration</span>   
    
    
    <span class="k">def</span> <span class="nf">__parse_EX_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ex</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        determine the coordinate transformation processing parameters (EX command). parameters from 1-byte hex</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ex: 1-byte hex string </span>
<span class="sd">        Returns:</span>
<span class="sd">            string - coordinate transformation processing parameter </span>
<span class="sd">        &quot;&quot;&quot;</span>      
    
        <span class="n">LSB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_LE_bit_string</span><span class="p">(</span><span class="n">ex</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="n">coord_sys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;00&#39;</span><span class="p">:</span> <span class="s1">&#39;BEAM COORDINATES&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;01&#39;</span><span class="p">:</span> <span class="s1">&#39;INSTRUMENT COORDINATES&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;10&#39;</span><span class="p">:</span> <span class="s1">&#39;SHIP COORDINATES&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;11&#39;</span><span class="p">:</span> <span class="s1">&#39;EARTH COORDINATES&#39;</span><span class="p">}</span>    
        
        <span class="n">coord_system</span><span class="o">=</span> <span class="n">coord_sys</span><span class="p">[</span><span class="n">LSB</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]]</span>
        
        <span class="k">return</span> <span class="n">coord_system</span>

 
    
<div class="viewcode-block" id="Pd0.write_pd0">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.Pd0.write_pd0">[docs]</a>
    <span class="k">def</span> <span class="nf">write_pd0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fname</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fname</span><span class="si">}</span><span class="s1">.000&#39;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span>  
    <span class="c1"># __write_next_bytes(127,ensemble_header_format[0],file)</span>

        <span class="k">for</span> <span class="n">e</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write_ensemble</span><span class="p">(</span><span class="n">ensemble</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   </div>





    <span class="k">def</span> <span class="nf">__write_ensemble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ensemble</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># # write the ensemble header </span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">ensemble_header_format</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">field</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ADDRESS OFFSETS&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span><span class="n">address_offsets_format</span><span class="p">)</span>
        
            
        <span class="c1">#Write the fixed leader (data type 1)</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fixed_leader_format</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">field</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">variable_leader_format</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">field</span><span class="p">)</span>
               
        <span class="c1">## Write data type 3 (velocity)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;VELOCITY ID&#39;</span><span class="p">],</span><span class="n">data_ID_code_format</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF BEAMS&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VELOCITY&#39;</span><span class="p">][</span><span class="n">cell</span><span class="p">][</span><span class="n">beam</span><span class="p">],</span><span class="n">velocity_format</span><span class="p">)</span>
        
        <span class="c1">## Write data type 4 (correlation Magnitude)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ID CODE 4&#39;</span><span class="p">],</span><span class="n">data_ID_code_format</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF BEAMS&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;CORRELATION MAGNITUDE&#39;</span><span class="p">][</span><span class="n">cell</span><span class="p">][</span><span class="n">beam</span><span class="p">],</span><span class="n">coor_mag_format</span><span class="p">)</span>
                
        <span class="c1">## Write data type 5 (echo intensity)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ID CODE 5&#39;</span><span class="p">],</span><span class="n">data_ID_code_format</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF BEAMS&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ECHO INTENSITY&#39;</span><span class="p">][</span><span class="n">cell</span><span class="p">][</span><span class="n">beam</span><span class="p">],</span><span class="n">echo_intensity_format</span><span class="p">)</span>
        
        <span class="c1">## Write data type 6 (percent good)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ID CODE 6&#39;</span><span class="p">],</span><span class="n">data_ID_code_format</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]):</span>
            <span class="n">cell_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">beam</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF BEAMS&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;PERCENT GOOD&#39;</span><span class="p">][</span><span class="n">cell</span><span class="p">][</span><span class="n">beam</span><span class="p">],</span><span class="n">pct_good_format</span><span class="p">)</span>     
          
        <span class="c1"># write bottom track data, if recorded</span>
        <span class="k">if</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;BOTTOM TRACK&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;N DATA TYPES&#39;</span><span class="p">]</span> <span class="o">==</span><span class="mi">7</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">bottom_track_format</span><span class="p">:</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;BOTTOM TRACK&#39;</span><span class="p">][</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">field</span><span class="p">)</span> 
            
        
        <span class="c1">#write reserved bit data </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;ENSEMBLE HEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RESERVED BIT DATA&#39;</span><span class="p">],</span><span class="n">data_ID_code_format</span><span class="p">)</span>
        
        <span class="c1"># write end of ensemble checksum </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__write_next_bytes</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span><span class="p">)</span><span class="o">%</span><span class="mi">65536</span><span class="p">,</span><span class="n">data_ID_code_format</span><span class="p">)</span> <span class="c1">#chacksum to verify</span>
        
    
    
    <span class="k">def</span> <span class="nf">__write_next_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">fmt</span><span class="p">):</span>
        <span class="n">decoded</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">decoded</span><span class="p">:</span>   
            <span class="k">if</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
                <span class="n">write_bytes</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">,</span><span class="n">signed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">write_bytes</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">,</span><span class="n">signed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">write_bytes</span> <span class="o">=</span> <span class="n">x</span>
            
        <span class="c1"># n_bytes_written += n    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checksum</span> <span class="o">+=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">write_bytes</span><span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_bytes</span><span class="p">)</span>   </div>

        
<span class="c1">###############################################################################</span>
<span class="c1">#%% Analytics Wrapper </span>

<div class="viewcode-block" id="DataSet">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet">[docs]</a>
<span class="k">class</span> <span class="nc">DataSet</span><span class="p">(</span><span class="n">Pd0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extends the Pd0 class to provide enhanced analytical capabilities specifically</span>
<span class="sd">    tailored for handling and analyzing ADCP data.</span>

<span class="sd">    This class offers methods for extracting time series data from variable and fixed</span>
<span class="sd">    leaders, computing derived quantities like velocities and displacements, and applying</span>
<span class="sd">    corrections such as timezone or magnetic deviations. It also facilitates the integration</span>
<span class="sd">    with other data types like PT3 data for comprehensive analyses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        timezone_correction (int): Hours to adjust the time data for local timezone corrections.</span>
<span class="sd">        magnetic_deviation_correction (float): Degrees to adjust the velocity data for magnetic deviations.</span>
<span class="sd">        name (str): A derived name from the filepath, generally the filename.</span>
<span class="sd">        n_ensembles (int): Number of ensembles loaded into memory.</span>
<span class="sd">        config (config_parameters): Configuration parameters derived from the ADCP data.</span>
<span class="sd">        plot (plotting): A plotting tool associated with the dataset for visual analysis.</span>
<span class="sd">        processing (processing): Processing tools for data manipulation and computation.</span>
<span class="sd">        geometry (geometry): Geometrical tools for handling spatial dimensions and transformations.</span>
<span class="sd">        mask (masking): Masking tools for data cleaning and preparation.</span>
<span class="sd">        PT3 (PT3, optional): PT3 data associated with the dataset, if provided.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __init__(filepath, **kwargs): Initializes the DataSet instance with the specified ADCP data file and optional parameters.</span>
<span class="sd">        get_ensemble_datetimes(): Returns an array of datetime objects representing the timestamps of each ensemble.</span>
<span class="sd">        get_leader_data(field, leader=&#39;VARIABLE LEADER&#39;, dtype=int): Retrieves time series data for a specified field from the leader data.</span>
<span class="sd">        get_ensemble_numbers(): Returns an array of ensemble numbers.</span>
<span class="sd">        get_sensor_transmit_pulse_lengths(): Retrieves the ADCP transmit pulse lengths.</span>
<span class="sd">        get_sensor_temperature(): Retrieves the temperature data from the sensor.</span>
<span class="sd">        get_bit_result(): Retrieves the built-in test result from the ADCP.</span>
<span class="sd">        get_salinity(): Retrieves the salinity data from the sensor.</span>
<span class="sd">        get_sensor_pitch(): Retrieves the pitch data from the sensor.</span>
<span class="sd">        get_sensor_roll(): Retrieves the roll data from the sensor.</span>
<span class="sd">        get_sensor_heading(): Retrieves the heading data from the sensor.</span>
<span class="sd">        get_sensor_transducer_depth(): Retrieves the depth of the transducer below the water surface.</span>
<span class="sd">        get_velocity(field_name=&#39;VELOCITY&#39;): Retrieves velocity data along with calculated displacements.</span>
<span class="sd">        get_bottom_track(): Retrieves bottom tracking data from the ADCP.</span>
<span class="sd">        get_ensemble_array(field_name=&#39;ECHO INTENSITY&#39;, mask=True): Formats specified ensemble data field into a numpy array with optional masking.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="DataSet.__init__">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filepath</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        
        <span class="c1"># parse kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timezone_correction</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;timezone_correction&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_deviation_correction</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;magnetic_deviation_correction&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">)</span>
        <span class="c1">#self.set_instrument_config_parameters() # set instrument configuration params</span>
        


        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">processing</span> <span class="o">=</span> <span class="n">processing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">masking</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        
                    
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pt3_filepath&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PT3</span> <span class="o">=</span> <span class="n">PT3</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pt3_filepath&#39;</span><span class="p">))</span></div>


    

<div class="viewcode-block" id="DataSet.get_ensemble_datetimes">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_ensemble_datetimes">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ensemble_datetimes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ensemble</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate numpy array of datetimes for ensembles. </span>
<span class="sd">        Args:</span>
<span class="sd">            None</span>
<span class="sd">        Returns:</span>
<span class="sd">            numpy array with dimensions (n_ensembles)  </span>
<span class="sd">        &quot;&quot;&quot;</span>           

        <span class="n">dtimes</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">century</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC CENTURY&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">century</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;19&#39;</span><span class="p">,</span><span class="s1">&#39;20&#39;</span><span class="p">]:</span> <span class="n">century</span> <span class="o">=</span> <span class="s1">&#39;20&#39;</span> 
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">century</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC YEAR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]))</span>
            <span class="n">month</span><span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC MONTH </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">day</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC DAY </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC HOUR </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">minute</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC MINUTE </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">second</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC SECOND </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="n">hundredth</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC HUNDREDTHS </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span><span class="n">minute</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">hundredth</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone_correction</span><span class="p">))</span> 
            <span class="k">except</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;RTC MONTH </span><span class="si">{TS}</span><span class="s1">&#39;</span><span class="p">])</span>
                <span class="c1">#print(str(ensemble[&#39;VARIABLE LEADER&#39;][&#39;RTC YEAR {TS}&#39;]))</span>
                <span class="n">dtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">month</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">hour</span><span class="p">,</span><span class="n">minute</span><span class="p">,</span><span class="n">second</span><span class="p">,</span><span class="n">hundredth</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone_correction</span><span class="p">))</span> 
                <span class="c1"># dtimes.append(np.nan)</span>
                <span class="c1"># break</span>
            
        <span class="n">dtimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dtimes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dtimes</span>    </div>



        
    
<div class="viewcode-block" id="DataSet.get_leader_data">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_leader_data">[docs]</a>
    <span class="k">def</span> <span class="nf">get_leader_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field</span><span class="p">,</span><span class="n">leader</span> <span class="o">=</span> <span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a timeseries of data from fixed leader or variable leader. field </span>
<span class="sd">        names are identical to those in Workhorse Commands and Output Data </span>
<span class="sd">        Format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        field : str</span>
<span class="sd">            field name.</span>
<span class="sd">        leader : ste, optional</span>
<span class="sd">            &#39;FIXED LEADER&#39; or &#39;VARIABLE LEADER&#39;. The default is &#39;VARIABLE LEADER&#39;.</span>
<span class="sd">        dtype : numpy dtype, optional</span>
<span class="sd">            data type for the output numpy array. The default is int.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : numpy array</span>
<span class="sd">             One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="n">leader</span><span class="p">][</span><span class="n">field</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">data</span> </div>

        
<div class="viewcode-block" id="DataSet.get_ensemble_numbers">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_ensemble_numbers">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ensemble_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the ensemble number for every ensemble. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ensemble_numbers : numpy array</span>
<span class="sd">            ensemble numbers. One value for each ensemble.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ensemble_numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_leader_data</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;ENSEMBLE NUMBER&#39;</span><span class="p">,</span><span class="n">leader</span> <span class="o">=</span> <span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ensemble_numbers</span></div>


        
<div class="viewcode-block" id="DataSet.get_sensor_transmit_pulse_lengths">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_sensor_transmit_pulse_lengths">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sensor_transmit_pulse_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get ADCP transmit pulse lengths. Data is from the ensemble variable headers.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        transmit_pulse_lengths : numpy array</span>
<span class="sd">            ADCP transmit pule lengths. One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">transmit_pulse_lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_leader_data</span><span class="p">(</span><span class="n">field</span> <span class="o">=</span> <span class="s1">&#39;XMIT PULSE LENGTH BASED ON </span><span class="si">{WT}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">leader</span> <span class="o">=</span> <span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span>
        <span class="k">return</span> <span class="n">transmit_pulse_lengths</span>  </div>

    
<div class="viewcode-block" id="DataSet.get_sensor_temperature">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_sensor_temperature">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sensor_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Temperature of the water at the transducer head</span>
<span class="sd">        (ET-command). This value may be a manual setting or a</span>
<span class="sd">        reading from a temperature sensor.</span>
<span class="sd">        Scaling: LSD = 0.01 degree; Range = -5.00 to +40.00 degrees</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        temperature : numpy array</span>
<span class="sd">            ADCP temperature data in degrees C. One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">temperature</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;TEMPERATURE </span><span class="si">{ET}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
        <span class="k">return</span> <span class="n">temperature</span></div>

    
<div class="viewcode-block" id="DataSet.get_bit_result">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_bit_result">[docs]</a>
    <span class="k">def</span> <span class="nf">get_bit_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This field contains the results of the WorkHorse ADCPs Builtin</span>
<span class="sd">        Test function. A zero code indicates a successful BIT</span>
<span class="sd">        result.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bit_result : numpy array</span>
<span class="sd">            ADCP bit result data. One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bit_result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">bit_result</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;BIT RESULT&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
        <span class="k">return</span> <span class="n">bit_result</span></div>

    
<div class="viewcode-block" id="DataSet.get_salinity">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_salinity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_salinity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Salinity value of the water at the transducer</span>
<span class="sd">        head (ES-command). This value may be a manual setting or</span>
<span class="sd">        a reading from a conductivity sensor.</span>
<span class="sd">        Scaling: LSD = 1 part per thousand; Range = 0 to 40 ppt</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        salinity : numpy array</span>
<span class="sd">            One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">salinity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">salinity</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;SALINITY </span><span class="si">{ES}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">salinity</span></div>

    
<div class="viewcode-block" id="DataSet.get_sensor_pitch">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_sensor_pitch">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sensor_pitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WorkHorse ADCP pitch angle (EP-command).</span>
<span class="sd">        This value may be a manual setting or a reading from a tilt</span>
<span class="sd">        sensor. Positive values mean that Beam #3 is spatially</span>
<span class="sd">        higher than Beam #4.</span>
<span class="sd">        Scaling: LSD = 0.01 degree; Range = -20.00 to +20.00 degrees</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pitch : numpy array</span>
<span class="sd">            One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">pitch</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;PITCH TILT 1 </span><span class="si">{EP}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
        <span class="k">return</span> <span class="n">pitch</span></div>

    
<div class="viewcode-block" id="DataSet.get_sensor_roll">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_sensor_roll">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sensor_roll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WorkHorse ADCP roll angle (ER-command).</span>
<span class="sd">        This value may be a manual setting or a reading from a tilt</span>
<span class="sd">        sensor. For up-facing WorkHorse ADCPs, positive values</span>
<span class="sd">        mean that Beam #2 is spatially higher than Beam #1. For</span>
<span class="sd">        down-facing WorkHorse ADCPs, positive values mean that</span>
<span class="sd">        Beam #1 is spatially higher than Beam #2.</span>
<span class="sd">        Scaling: LSD = 0.01 degree; Range = -20.00 to +20.00 degrees</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        roll : numpy array</span>
<span class="sd">            One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">roll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">roll</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ROLL TILT 2 </span><span class="si">{ER}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
        <span class="k">return</span> <span class="n">roll</span></div>

    
<div class="viewcode-block" id="DataSet.get_sensor_heading">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_sensor_heading">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sensor_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        WorkHorse ADCP heading angle (EHcommand).</span>
<span class="sd">        This value may be a manual setting or a reading</span>
<span class="sd">        from a heading sensor.</span>
<span class="sd">        Scaling: LSD = 0.01 degree; Range = 000.00 to 359.99 degrees</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        heading : numpy array</span>
<span class="sd">             One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">heading</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">heading</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;HEADING </span><span class="si">{EH}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
        <span class="k">return</span> <span class="n">heading</span></div>

    
<div class="viewcode-block" id="DataSet.get_sensor_transducer_depth">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_sensor_transducer_depth">[docs]</a>
    <span class="k">def</span> <span class="nf">get_sensor_transducer_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Depth of the transducer below the water surface</span>
<span class="sd">        (ED-command). This value may be a manual setting or a</span>
<span class="sd">        reading from a depth sensor.</span>
<span class="sd">        Scaling: LSD = 1 decimeter; Range = 1 to 9999 decimeters</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        transducer_depth : numpy array</span>
<span class="sd">             One value for each ensemble.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">transducer_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">transducer_depth</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="s1">&#39;VARIABLE LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;DEPTH OF TRANSDUCER </span><span class="si">{ED}</span><span class="s1">&#39;</span><span class="p">]</span>
        

        <span class="k">return</span> <span class="n">transducer_depth</span></div>

    
<div class="viewcode-block" id="DataSet.get_velocity">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_velocity">[docs]</a>
    <span class="k">def</span> <span class="nf">get_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span> <span class="o">=</span> <span class="s1">&#39;VELOCITY&#39;</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve velocity vectors including progressive vectors in m/s.</span>
<span class="sd">        Magnetic deviation correction is applied here. </span>
<span class="sd">        Parameters</span>
<span class="sd">        -------</span>
<span class="sd">        field_name: str, optional</span>
<span class="sd">            ensemble field name to use for velocity data. &#39;VELOCITY&#39; is default. </span>
<span class="sd">            Other options might be &#39;VELOCITY CORRECTED&#39; or other user specified velocity-like fields</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        u : numpy array</span>
<span class="sd">            u velocity array with dimensions (n_bins, n_ensembles)</span>
<span class="sd">        v : numpy array</span>
<span class="sd">            v velocity array with dimensions (n_bins, n_ensembles)</span>
<span class="sd">        z : numpy array</span>
<span class="sd">            z velocity array with dimensions (n_bins, n_ensembles)</span>
<span class="sd">        du : numpy array</span>
<span class="sd">            displacement in u direction. Array with dimensions (n_bins, n_ensembles)</span>
<span class="sd">        dv : numpy array</span>
<span class="sd">            displacement in v direction. Array with dimensions (n_bins, n_ensembles)</span>
<span class="sd">        dz : numpy array</span>
<span class="sd">            displacement in z direction. Array with dimensions (n_bins, n_ensembles)</span>
<span class="sd">        err: numpy array</span>
<span class="sd">            error velocity array with dimensions (n_bins, n_ensembles)</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        

        
        
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">))</span>
        <span class="n">ev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="c1"># cast velocity data as float</span>
            <span class="n">vel_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="n">field_name</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
            <span class="c1"># mark nan values </span>
            <span class="n">vel_data</span><span class="p">[</span><span class="n">vel_data</span><span class="o">==-</span><span class="mi">32768</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">vel_data</span><span class="p">[</span><span class="n">vel_data</span><span class="o">==</span><span class="mi">32768</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
            <span class="c1"># convert to m/s</span>
            <span class="n">vel_data</span> <span class="o">=</span> <span class="n">vel_data</span><span class="o">*</span><span class="mf">.001</span>


            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vel_data</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">:</span>
                <span class="n">u</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">vel_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">vel_data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">z</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">vel_data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">ev</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">vel_data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">v</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">z</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">ev</span><span class="p">[</span><span class="n">e</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_deviation_correction</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">):</span> <span class="c1"># loop over all bins and calculate rotated velocites for each</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u</span><span class="p">[:,</span><span class="n">b</span><span class="p">],</span><span class="n">v</span><span class="p">[:,</span><span class="n">b</span><span class="p">]])</span>
                
                <span class="n">X_rot</span> <span class="o">=</span> <span class="n">ptools</span><span class="o">.</span><span class="n">gen_rot_z</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">magnetic_deviation_correction</span><span class="p">)[:</span><span class="mi">2</span><span class="p">,:</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1">#print(X_rot.shape,X.shape)</span>
                <span class="n">X_rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X_rot</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>
                <span class="c1"># update u and v</span>
                <span class="n">u</span><span class="p">[:,</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_rot</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
                <span class="n">v</span><span class="p">[:,</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_rot</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>    
                
        <span class="c1">## gen prog vector components </span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ensemble_datetimes</span><span class="p">()</span>
        <span class="n">to_sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="c1"># vectorized function to convert datetime delta to total seconds</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">)</span>
        <span class="n">dt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_sec</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">dt</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="c1">#assign last value</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">))</span>
        <span class="n">du</span> <span class="o">=</span> <span class="n">u</span><span class="o">*</span><span class="n">dt</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">dt</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">dt</span>
        
        <span class="c1">#transpose to correct dimensions and apply active masks </span>
        <span class="c1"># u = self.mask.apply_masks(u.T)</span>
        <span class="c1"># v = self.mask.apply_masks(v.T)</span>
        <span class="c1"># z = self.mask.apply_masks(z.T)</span>
        <span class="c1"># du = self.mask.apply_masks(du.T)</span>
        <span class="c1"># dv = self.mask.apply_masks(dv.T)</span>
        <span class="c1"># dz = self.mask.apply_masks(dz.T)</span>
        <span class="c1"># ev = self.mask.apply_masks(ev.T)</span>
        
        <span class="k">return</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">du</span><span class="p">,</span><span class="n">dv</span><span class="p">,</span><span class="n">dz</span><span class="p">,</span><span class="n">ev</span>     </div>


<div class="viewcode-block" id="DataSet.get_bottom_track">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_bottom_track">[docs]</a>
    <span class="k">def</span> <span class="nf">get_bottom_track</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        beam_number : int</span>
<span class="sd">            beam number to use. if zero the beam average will be returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bt_range : numpy array</span>
<span class="sd">            numpy array of distance to bottom </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="n">bt_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;BOTTOM TRACK&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_beams</span><span class="p">):</span>
                    <span class="n">bt_range</span><span class="p">[</span><span class="n">b</span><span class="p">,</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;BOTTOM TRACK&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;BEAM#</span><span class="si">{</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> BT RANGE&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">bt_range</span><span class="p">[:,</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">bt_range</span> </div>

    
        <span class="c1">#else: print(&#39;No Bottom Track Data&#39;)</span>
        
        <span class="c1">#raise NotImplementedError()</span>


<div class="viewcode-block" id="DataSet.get_ensemble_array">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.DataSet.get_ensemble_array">[docs]</a>
    <span class="k">def</span> <span class="nf">get_ensemble_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">field_name</span> <span class="o">=</span> <span class="s1">&#39;ECHO INTENSITY&#39;</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Format ensemble data field into a numpy array. All active masks are applied </span>
<span class="s2">        to the ensemble data. </span>
<span class="s2">    </span>
<span class="s2">        Parameters</span>
<span class="s2">        ----------</span>
<span class="s2">        field_name : str, optional</span>
<span class="s2">            Ensemble data type (excluding velocity). [&#39;ECHO INTENSITY&#39;,</span>
<span class="s2">            &#39;PERCENT GOOD&#39;,&#39;CORRELATION MAGNITUDE&#39;, &#39;SIGNAL TO NOISE RATIO&#39;,</span>
<span class="s2">            &#39;ABSOLUTE BACKSCATTER&#39;). The default is &#39;ECHO INTENSITY&#39;.</span>
<span class="s2">        mask : bool, optional </span>
<span class="s2">            If True, all activated masks will be applied to the ensemble array.</span>
<span class="s2">            if False, the raw data will be returned. </span>
<span class="s2">    </span>
<span class="s2">        Returns</span>
<span class="s2">        -------</span>
<span class="s2">        X : numpy array</span>
<span class="s2">            Array of ensemble data with dimensions (n_beams,n_bins,n_ensembles).</span>
<span class="s2">    </span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="c1">## Case where all beams are returned </span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">):</span>
            <span class="n">column_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ensemble</span><span class="p">[</span><span class="n">field_name</span><span class="p">]]</span>
            <span class="n">X</span><span class="p">[:,:,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ensemble</span><span class="p">[</span><span class="n">field_name</span><span class="p">])</span>
        
        
        <span class="n">X</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">==</span><span class="mi">32768</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># # apply any masks    </span>
        <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">apply_masks</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">X</span>               </div>
</div>

         



<span class="c1">############### Misc Functions ################################################</span>
       
 

<span class="c1">############### Misc Functions ################################################</span>


<span class="c1">############### Masking Functions #############################################        </span>

<span class="c1">#%%</span>
<div class="viewcode-block" id="config_parameters">
<a class="viewcode-back" href="../../../pyplume.pd0.html#pyplume.pd0.pd0_decoder.config_parameters">[docs]</a>
<span class="k">class</span> <span class="nc">config_parameters</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pd0</span><span class="p">,</span><span class="n">en</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_ensembles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_beams</span> <span class="o">=</span> <span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF BEAMS&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_angle</span> <span class="o">=</span> <span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;BEAM ANGLE&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_1_distance</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;BIN 1 DISTANCE&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>      <span class="o">=</span> <span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">][</span><span class="s1">&#39;FREQUENCY&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_facing</span>    <span class="o">=</span> <span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">][</span><span class="s1">&#39;BEAM FACING&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">janus_config</span>   <span class="o">=</span> <span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">][</span><span class="s1">&#39;JANUS CONFIG&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_board_serial_number</span><span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;CPU BOARD SERIAL NUMBER&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_fw_rev</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;CPU F/W REV.&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_fw_ver</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;CPU F/W VER.&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instrument_serial_number</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;INSTRUMENT SERIAL NUMBER&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lag_length</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;LAG LENGTH&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_code_reps</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NO. CODE REPS&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_sim_flag</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;REAL/SIM FLAG&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensors_available</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;SENSORS AVAILABLE&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_configuration</span> <span class="o">=</span> <span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;SYSTEM CONFIGURATION&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpp_minutes</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;TPP MINUTES&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpp_seconds</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;TPP SECONDS&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transmit_lag_distance</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;TRANSMIT LAG DISTANCE&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pct_gd_minimum</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;</span><span class="si">%G</span><span class="s1">D MINIMUM </span><span class="si">{WG}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blank_after_transmit</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;BLANK AFTER TRANSMIT </span><span class="si">{WF}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinate_transform</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;COORDINATE TRANSFORM </span><span class="si">{EX}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_cell_length</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;DEPTH CELL LENGTH </span><span class="si">{WS}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="c1">#/100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_velocity_maximum</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;ERROR VELOCITY MAXIMUM </span><span class="si">{WE}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_target_thresh</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;FALSE TARGET THRESH </span><span class="si">{WA}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heading_alignment</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;HEADING ALIGNMENT </span><span class="si">{EA}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heading_bias</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;HEADING BIAS </span><span class="si">{EB}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_corr_thresh</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;LOW CORR THRESH </span><span class="si">{WC}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;NUMBER OF CELLS </span><span class="si">{WN}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pings_per_ensemble</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;PINGS PER ENSEMBLE </span><span class="si">{WP}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profiling_mode</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;PROFILING MODE </span><span class="si">{WM}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_source</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;SENSOR SOURCE </span><span class="si">{EZ}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starting_cell_wp_ref</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;starting cell WP REF LAYER AVERAGE </span><span class="si">{WL}</span><span class="s1"> ending cell&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_bandwidth</span> <span class="o">=</span> <span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;SYSTEM BANDWIDTH </span><span class="si">{WB}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_power</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;SYSTEM POWER </span><span class="si">{CQ}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpp_hundredths</span> <span class="o">=</span><span class="n">pd0</span><span class="o">.</span><span class="n">ensemble_data</span><span class="p">[</span><span class="n">en</span><span class="p">][</span><span class="s1">&#39;FIXED LEADER&#39;</span><span class="p">][</span><span class="s1">&#39;TPP HUNDREDTHS </span><span class="si">{TP}</span><span class="s1">&#39;</span><span class="p">]</span>          </div>

<span class="c1">#%%         </span>

<span class="c1"># fpath = r&#39;P:\\41806287\\41806287 NORI-D Data\\Data\\Fixed Stations\\02_Fixed_Bottom_Current_Turbidity\\01_FBCT1\\01_ADCP_600kHz-24149\\Raw\\FBCT1_Modem_Download_02112022\\FBCT1_0308_02112022.000&#39;</span>

<span class="c1"># fpath = r&#39;P:\\41806287\\41806287 NORI-D Data\\Data\\Fixed Stations\\02_Fixed_Bottom_Current_Turbidity\\01_FBCT1\\01_ADCP_600kHz-24149\\Raw\\FBCT1_Modem_Download_17102022\\FBCT1_0422_-1102022.000&#39;</span>
<span class="c1"># # fpath = r&#39;P:\41806287\41806287 NORI-D Data\Data\Fixed Stations\02_Fixed_Bottom_Current_Turbidity\01_FBCT1\01_ADCP_600kHz-24149\Raw\FBCT1_Modem_Download_10102022\FBCT1_0741_10102022.000&#39;</span>
<span class="c1"># fpath = r&#39;P:\\41806287\\41806287 NORI-D Data\\Data\\Fixed Stations\\02_Fixed_Bottom_Current_Turbidity\\01_FBCT1\\01_ADCP_600kHz-24149\\Raw\\FBCT1_Modem_Download_19102022\\FBCT1_1911_19102022.000&#39;</span>

<span class="c1"># #fpath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\Fixed Stations\02_Fixed_Bottom_Current_Turbidity\02_FBCT2\01_ADCP_600kHz-24144\Raw\Data Dump 09192022\09192020_2130.000&#39;</span>
<span class="c1"># #pd0 = Pd0(fpath, import_file = True)#, start = 2390, end = 16547)</span>

<span class="c1"># adcp = DataSet(fpath)</span>

<span class="c1"># t = adcp.get_ensemble_datetimes()</span>
<span class="c1">#%%</span>
<span class="c1"># # # # #fpath = r&#39;\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\Backups\\Raw_Data_Backup_Hidden_Gem\\ROV_data_HG\\ROVDive20220928\\DHIDive08004r.000&#39;</span>
<span class="c1"># pd0_fpath = r&#39;\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\41806287 NORI-D Data\\Data\\ROV\\Island Pride\\ADCP\\Raw\\ADCP_24142_600kHz\\ROV_ADCP_27102022\\_RDI_027.000&#39;</span>

<span class="c1"># pd0_fpath = r&#39;\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\41806287 NORI-D Data\\Data\\Fixed Stations\\03_Movable_Turbidity\\02_MT2\\01_ADCP_600kHz-24146\\Raw\\MTS2_000.000&#39;</span>
<span class="c1"># # pd0 = Pd0(fpath, import_file = False,)# start = 2390, end = 16547)  # 2390</span>
<span class="c1"># # # pd0 = Pd0(fpath, import_file = True, start = 2390, end = 16547)  # 2390</span>


<span class="c1"># pd0_fpath = &#39;RDI_Combine_20181127_20190111_export.000&#39;</span>



<span class="c1"># # # # pt3_fpath = &#39;\\\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\41806287 NORI-D Data\\Data\\ROV\\Island Pride HD14\\ADCP\\Config\\ROV_ADCP_20161_PT3.txt&#39;</span>


<span class="c1"># pd0 = Pd0(pd0_fpath, import_file = True)#, start = 1, end = 5)</span>
<span class="c1"># e = pd0.ensemble_data</span>
<span class="c1">#%%</span>
<span class="c1"># f = open(pd0_fpath,&#39;rb&#39;)</span>

<span class="c1"># print(f.read(2))</span>
<span class="c1"># print(f.read(2))</span>
<span class="c1"># print(f.read(2))</span>
<span class="c1"># print(f.read(2))</span>
<span class="c1"># f.close()</span>

<span class="c1"># f = open(pd0_fpath,&#39;rb&#39;)</span>


<span class="c1"># f.close()</span>
<span class="c1">#%%</span>

<span class="c1"># #%%</span>
<span class="c1"># # pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\Fixed Stations\02_Fixed_Bottom_Current_Turbidity\01_FBCT1\01_ADCP_600kHz-24149\Raw\FBCT1_Full_Download_17112022\FBCT1000.000&#39;</span>
<span class="c1"># # pt3_filepath  =  r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\Fixed Stations\02_Fixed_Bottom_Current_Turbidity\01_FBCT1\01_ADCP_600kHz-24149\Config_File\FBCT01_P3_TEST_17112022.txt&#39;</span>


<span class="c1"># pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\Fixed Stations\02_Fixed_Bottom_Current_Turbidity\01_FBCT1\01_ADCP_600kHz-24149\Raw\FBCT1_Full_Download_17112022\FBCT1000.000&#39;</span>
<span class="c1"># # # # # pt3_filepath  =  r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\Fixed Stations\02_Fixed_Bottom_Current_Turbidity\01_FBCT1\01_ADCP_600kHz-24149\Config_File\FBCT01_P3_TEST_17112022.txt&#39;</span>


<span class="c1"># # # pt3_filepath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\ROV\Island Pride HD14\ADCP\Config\ROV_ADCP_20161_PT3.txt&#39;</span>

<span class="c1"># # # # pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\Fixed Stations\04_Fixed_Turbidity\02_FT2\01_ADCP_600kHz-24157\Raw\FTS2_000.000&#39;</span>
<span class="c1"># # # # pt3_filepath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\Fixed Stations\04_Fixed_Turbidity\02_FT2\01_ADCP_600kHz-24157\Config_File\PT3.txt&#39;</span>
<span class="c1"># # # # # pd0_filepath = r&#39;C:\Users\anba\OneDrive - DHI\Desktop\Projects\NORI Post-Campaign\PCV ADCP\ADCP_PCV_Setup\CL16_\CL16_001.000&#39;</span>
<span class="c1"># pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\ROV\Island Pride HD14\ADCP\Raw\ADCP_24142_600kHz\ROV_ADCP_07102022\_RDI_000.000&#39;</span>
<span class="c1"># # # # pd0 = Pd0(pd0_fpaths[0],import_file = False)#.write_pd0(&#39;test2&#39;)  </span>
<span class="c1"># # pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\Backups\\Raw_Data_Backup_Hidden_Gem\\ROV_data_HG\ROVDive20221103\DHIDive28002r.000&#39;                                                                                          </span>
<span class="c1"># pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\Backups\\Raw_Data_Backup_Hidden_Gem\\ROV_data_HG\\ROVDive20221026\\DHIDive26002r.000&#39;</span>


<span class="c1"># pd0 = Pd0(pd0_filepath, import_file = False)#,print_progress = False, start = 3535, end= 3539)</span>
<span class="c1"># ds = DataSet(pd0_filepath, import_file = True,print_progress = True)#, start = 2189, end= 2189)</span>
<span class="c1"># # print(ds.get_ensemble_numbers())</span>
<span class="c1">#plt.plot(np.diff(pd0.get_ensemble_numbers()))</span>
<span class="c1"># pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\Backups\\Raw_Data_Backup_Hidden_Gem\\ROV_data_HG\\ROVDive20221021\\DHIDive22005r.000&#39;</span>
<span class="c1"># #pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\Projects\41806287\41806287 NORI-D Data\Data\ROV\Island Pride HD14\ADCP\Raw\ADCP_24142_600kHz\ROV_ADCP_07102022\_RDI_013.000&#39;</span>
<span class="c1"># # # pd0_filepath = r&#39;\\USDEN1-STOR.DHI.DK\\Projects\\41806287\\Backups\\Raw_Data_Backup_Hidden_Gem\\ROV_data_HG\\ROVDive20220810\\test005r.000&#39;</span>
<span class="c1"># pd0 = Pd0(pd0_filepath,import_file = False)</span>
<span class="c1"># #%%</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, anba.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>